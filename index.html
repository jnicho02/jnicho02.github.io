<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>

    It's All In The Game</title>
    <!-- Bootstrap 4 alpha CSS -->
    <!-- IMPORTANT: Don't use this .css file in production. Use Bootstrap 3 until Bootstrap 4.0.0 is released. -->
    <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css">

    <link href="/stylesheets/normalize.css" rel="stylesheet" /><link href="/stylesheets/all.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
  </head>

  <body class="index">


        <nav class="navbar navbar-fixed-top navbar-dark bg-inverse">
      <!-- Brand -->
      <a class="navbar-brand" href="/"><img src="/images/jez.jpg" width="80em" class="img-circle pull-left" alt="Photo of Jez Nicholson"></a>
      <!-- Links -->
      <ul class="nav navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link 2</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Contact</a>
        </li>
      </ul>
    </nav>

    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <div class="container-fluid">
      <h1></h1>
      
<div class="card-columns">
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/08/05/read-the-medium-is-the-massage/">read "The Medium is the Massage" by Marshall McLuhan</a></h4>
        <p class="card-text"><p>â€‹â€‹A fairly quick read, but amazing.</p>
</p>
      </div>
      <div class="card-footer">
        <small>Aug  5</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/07/20/attended-brighton-ruby-conference-2015/">attended Brighton Ruby Conference 2015</a></h4>
        <p class="card-text">
</p>
      </div>
      <div class="card-footer">
        <small>Jul 20</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/07/20/read-the-art-of-the-start/">read "The Art of the Start 2.0" by Guy Kawasaki</a></h4>
        <p class="card-text"><p>â€‹â€‹This book was so good that I read it twice.</p>
</p>
      </div>
      <div class="card-footer">
        <small>Jul 20</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/07/15/attended-geomob/">attended geomob July 2015</a></h4>
        <p class="card-text">
</p>
      </div>
      <div class="card-footer">
        <small>Jul 15</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/06/26/athereum-hack-day/">attended Blockchain Hack Day</a></h4>
        <p class="card-text"><p>On Friday I attended a hack day with the very nice people at Bright Minded in Hove.</p>

<p>We had a general introduction to blockchain and tried to get our heads round it.</p>

<p>I did an install</p>

<pre><code>go get github.com/ethereum/go-ethereum
</code></pre>

<p>changed directory to that directory, which is a git repo</p>

<pre><code>git checkout tags/v0.9.32
brew install gmp
make geth

./geth --networkid 8454 --datadir ~/development/ethereum/ console 2&gt;&gt;~/geth.log

modules: admin:1.0 db:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 shh:1.0 txpool:1.0 web3:1.0 ...are all the objects you can relate to
</code></pre>

<p>they are javascript-like objects so can be examined</p>

<pre><code>admin
{
  chainSyncStatus: {
    blocksAvailable: 0,
    blocksWaitingForImport: 0,
    estimate: '0',
    importing: 0
  },
  datadir: '/Users/jeznicholson/development/ethereum',
  nodeInfo: {
    DiscPort: 30303,
    IP: '::',
    ListenAddr: '[::]:30303',
    Name: 'Geth/v0.9.32-72e2613a/darwin/go1.4',
    NodeID: '9d8fd63b27e187ddbf205f5a4657a856bc98e28859119fa2fe37450c6b64aa9ec5cdac3bdc3231b2edff7587278c5079181dc38c9545b9933c01feda110a9cf7',
    NodeUrl: 'enode://9d8fd63b27e187ddbf205f5a4657a856bc98e28859119fa2fe37450c6b64aa9ec5cdac3bdc3231b2edff7587278c5079181dc38c9545b9933c01feda110a9cf7@[::]:30303',
    TCPPort: 30303,
    Td: '131072'
  },
  peers: Error: ,
  addPeer: function (),
  exportChain: function (),
  getChainSyncStatus: function (),
  getDatadir: function (),
  getNodeInfo: function (),
  getPeers: function (),
  importChain: function (),
  setSolc: function (),
  startRPC: function (),
  stopRPC: function (),
  verbosity: function ()
}
&gt; personal
{
  listAccounts: [ ],
  getListAccounts: function (),
  newAccount: function (),
  unlockAccount: function ()
}



&gt; personal.newAccount('changeme')
'0x19a290998213a98e21820dc8aaf2cdf91248019b'
&gt; personal.listAccounts
['0x19a290998213a98e21820dc8aaf2cdf91248019b' ]
</code></pre>

<p>on first mining operation it creates the direct acyclic graph (DAG)</p>

<pre><code>miner.start()
true

I0626 12:17:51.450205   91056 ethash.go:192] Generating DAG for epoch 0 (0000000000000000000000000000000000000000000000000000000000000000)
I0626 12:17:51.456824   91056 backend.go:588] checking DAG (ethash dir: /Users/jeznicholson/.ethash)
I0626 12:17:52.921007   91056 ethash.go:220] Still generating DAG: 0%
I0626 12:17:58.853706   91056 ethash.go:220] Still generating DAG: 1%
I0626 12:18:04.591292   91056 ethash.go:220] Still generating DAG: 2%
I0626 12:18:10.329969   91056 ethash.go:220] Still generating DAG: 3%
I0626 12:18:16.091094   91056 ethash.go:220] Still generating DAG: 4%
I0626 12:18:21.813244   91056 ethash.go:220] Still generating DAG: 5% .....
</code></pre>

<p>this takes a whileâ€¦.</p>

<pre><code>I0626 12:27:41.830801   91056 ethash.go:209] Done generating DAG for epoch 0, it took 9m50.380632239s
I0626 12:28:14.391098   91056 chain_manager.go:700] imported 1 block(s) (0 queued 0 ignored) including 0 txs in 1.62743908s. #1 [2ef06f38 / 2ef06f38]
I0626 12:28:14.391462   91056 worker.go:257] ðŸ”¨  Mined block (#1 / 2ef06f38). Wait 5 blocks for confirmation
I0626 12:28:14.420487   91056 worker.go:415] commit new work on block 2 with 0 txs &amp; 0 uncles. Took 24.225227ms
</code></pre>

<p>to find out how quickly you are mining, find the hashrate and how difficult it was</p>

<pre><code>miner.hashrate
98051
eth.getBlock('latest').difficulty / miner.hashrate
3.456579300817376
</code></pre>

<p>to get the balance</p>

<pre><code>eth.getBalance(eth.accounts[0])
'215437500000000000000'
web3.fromWei(eth.accounts[0],"ether")
'146350086398035993514202957176.321948109911884187'

var name = "jez"
undefined
eth.namereg.addr(name)
'0x'

var sender = eth.accounts[0]
eth.sendTransaction({from: sender, to: receiver, value: amount})
</code></pre>

<p>https://chriseth.github.io/cpp-ethereum/</p>

<pre><code>contract jtoken {
  mapping (address =&gt; uint) public balances;
  address public admin;
  uint tax;
  
  function jtoken()
  {
    balances[msg.sender] = 1000;
    admin = msg.sender;
    tax = 1;
  }
  
  function sendToken(address receiver, uint amount)
  {
    if(balances[msg.sender] &lt; amount + tax) return;
    balances[msg.sender] -= amount;
    balances[receiver] += amount;
    balances[admin] += tax;
  }
  
  function setTax(uint value)
  {
      if (msg.sender == admin) return;
      tax = value;
  }
  
  function getBalance() returns (uint)
  {
      return balances[msg.sender];
  }
  
  function kill() {
    if (msg.sender == admin) {
      suicide(admin);
    }
  }
}
</code></pre>

<p>var jtoken = eth.sendTransaction({data: '0x60606040525b6103e8600060005060003373ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000508190555033600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff0219169083021790555060016002600050819055505b6103cb806100816000396000f30060606040523615610074576000357c01000000000000000000000000000000000000000000000000000000009004806312065fe01461007657806327e235e3146100975780632e5bb6ff146100be578063412664ae146100d157806341c0e1b5146100ea578063f851a440146100f757610074565b005b6100816004506102fb565b6040518082815260200191505060405180910390f35b6100a8600480359060200150610154565b6040518082815260200191505060405180910390f35b6100cf600480359060200150610292565b005b6100e860048035906020018035906020015061016f565b005b6100f5600450610337565b005b61010260045061012e565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60006000506020528060005260406000206000915090505481565b6002600050548101600060005060003373ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000505410156101b25761028e565b80600060005060003373ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282825054039250508190555080600060005060008473ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282825054019250508190555060026000505460006000506000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828282505401925050819055505b5050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156102ed576102f8565b806002600050819055505b50565b6000600060005060003373ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600050549050610334565b90565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614156103c857600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b5b56', from: eth.accounts[0], gas: 1000000, gasPrice: web3.toWei(0.001, "finney")})
eth.getCode(jtoken)</p>

<p>var address = '0x5b3ac9cd817a30f3e614a313f044e461697a718f';
var abi = [{"constant":false,"inputs":[],"name":"checkGoalReached","outputs":[{"name":"response","type":"bytes32"}],"type":"function"},{"constant":true,"inputs":[],"name":"deadline","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"beneficiary","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":false,"inputs":[{"name":"_beneficiary","type":"address"},{"name":"_fundingGoal","type":"uint256"},{"name":"_duration","type":"uint256"},{"name":"_price","type":"uint256"},{"name":"_reward","type":"address"}],"name":"setup","outputs":[{"name":"response","type":"bytes32"}],"type":"function"},{"constant":true,"inputs":[],"name":"tokenReward","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"fundingGoal","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"amountRaised","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"price","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"numFunders","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"funders","outputs":[{"name":"addr","type":"address"},{"name":"amount","type":"uint256"}],"type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"type":"function"},{"inputs":[],"type":"constructor"}];
var instance = eth.contract(abi).at(address)</p>

</p>
      </div>
      <div class="card-footer">
        <small>Jun 26</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/06/04/attended-brighton-ruby-meetup/">attended Brighton Ruby Group Meetup</a></h4>
        <p class="card-text"><p>â€‹This is a regular monthly <a href="http://www.meetup.com/Brighton-Ruby-Group/">Meetup</a> that brings Ruby developers together.</p>

<p>Andy Croll gave a talk about the joys of Rails ActiveJob. This is essentially a standard interface to different technologies that enable work items to be queued and/or scheduled for later processing. The main benefit being that potentially slow tasks can be offloaded from the main processing thread and run at a more convenient pace.</p>

<p>The most common usage is for emailing as this is notorious for having slow-running processes.</p>

<pre><code>UserMailer.welcome(@user).deliver_later
</code></pre>

<p>Use of ActiveJob could lead to different thinking if you broke a larger update into multiple tiny ones, for example updating cached counts. Error handling needs to be considered. The paradigm shift may come from when it is not essential that every single task succeeds.</p>
</p>
      </div>
      <div class="card-footer">
        <small>Jun  4</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/06/02/data-tiles-in-leaflet/">Data tiles in Leaflet</a></h4>
        <p class="card-text"><p>Here is a little something i've been playing with. After the first flush of plotting points on a Leaflet map I soon realised that things can get quite slow. I've been building a tile-based data server which is hooked in to the map tile calls in the javascript. It isn't an original thought (i'll add in links to original references when I find them) but i've taken it a bit further than other people have.</p>

<p>This post is not complete, I will be expanding it.</p>

<p>â€‹â€‹A short videoâ€¦</p>

<p>https://youtu.be/2PCPa8PuHng</p>

<p>Leaflet is very quick and easy to get a map up and running.</p>

<p><img alt="/images/basic_map.png" src="/images/basic_map.png" /></p>

<p>If you return points from your data server as geojson they can be hooked straight in
<img alt="/images/some_points.png" src="/images/some_points.png" /></p>

<p>That is a bit ugly, but the <a href="https://github.com/Leaflet/Leaflet.markercluster">Leaflet.markerclusterer</a> comes to the rescue</p>

<p><img alt="/images/clusters.png" src="/images/clusters.png" /></p>

<p>If you don't have an awful lot of data then you could simply load all of it from a single geojson file. We have 35000+ plaques on Open Plaques so passing the entire database is not an option.</p>

<p>The standard functionality is to trigger a bounding box query with <a href="http://jasonsanford.github.io/leaflet-vector-layers/">leaflet-vector-layers</a> or similar. Top-left and  bottom-right coordinates are sent as parameters in whatever url structure you tell it.</p>

<p><img alt="/images/bounding_box.png" src="/images/bounding_box.png" /></p>

<p>A bounding box is a very simple SQL query</p>

<pre><code>SELECT * from plaques
WHERE latitude between (a and b)
AND longitude between (x and y)
</code></pre>

<p>And if you index on 'latitude, longitude' then it should run pretty quick.</p>

<p>However, once you do a big zoom then you'll be doing a correspondingly large SQL query :( Large numbers of records could be returned. In our case this pushed the http call past the Heroku 12 second maximum and it assumed that our server had hung.</p>

<p><img alt="/images/big_zoom.png" src="/images/big_zoom.png" /></p>

<p>A slippymap is made of tilesâ€¦</p>

<p><img alt="/images/tiles.png" src="/images/tiles.png" /></p>

<p>It is fairly trivial to convert from tile number -&gt; coordinates and vice versa. The formulae are published on the <a href="http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames">OpenStreetMap Wiki Slippy_map_tilenames</a></p>

<p><img alt="/images/do_the_math.png" src="/images/do_the_math.png" /></p>

<p><img alt="/images/tiled_calls.png" src="/images/tiled_calls.png" /></p>

<p><img alt="/images/one_data_tile.png" src="/images/one_data_tile.png" /></p>

<p>Big zoom. Lots of little SQL queries :)</p>

<p><img alt="/images/big_zoom_tiled.png" src="/images/big_zoom_tiled.png" /></p>

<p>Standardize on one zoom level for the data calls. This will reduce the number of calls made and enable us to cache the results.</p>

<p><img alt="/images/data_at_one_level.png" src="/images/data_at_one_level.png" /></p>

<p>Speed Improvements</p>

<ul>
  <li>Only query at one zoom level</li>
  <li>Streamline the SQL</li>
  <li>Donâ€™t repeat calls, keep a list</li>
  <li>Cache json on the server with Redis or memcached</li>
  <li>Dump to filesâ€¦</li>
</ul>

<p><img alt="/images/cached_json.png" src="/images/cached_json.png" /></p>

<p>What's left?</p>

<ul>
  <li>Country level view fires a lot of calls</li>
  <li>Can flood the server</li>
  <li>Restrict the maximum map zoom level?</li>
  <li>Store aggregated counts</li>
</ul>

<p>Alternatives?
* http://agentscript.org/docs/data.tile.html
* http://bl.ocks.org/glenrobertson/6203331</p>
</p>
      </div>
      <div class="card-footer">
        <small>Jun  2</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/05/20/read-inside-of-a-dog/">read "Inside of a Dog" by Alexandra Horowitz</a></h4>
        <p class="card-text"><p>â€‹â€‹This might seem an unusual choice for a User Experience book. But, how humans and canines interact is very telling on the human condition. Our intense desire to anthropomorphise animals (and objects) is a core component of being human. Conversely, dogs ability to act as-if they have human qualities is what brought them inside our homes whilst the wolves stayed outside. A computer system has less intelligence than a dog. If we thought a little bit more about how they behave then we might be able to build systems that are loveable</p>
</p>
      </div>
      <div class="card-footer">
        <small>May 20</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/05/19/attended-esri-uk-2015-conference/">attended ESRI UK conference 2015</a></h4>
        <p class="card-text">
</p>
      </div>
      <div class="card-footer">
        <small>May 19</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
    <div class="card" name="article-summary" style="max-width: 40rem;">
      <div class="card-block">
        <h4 class="card-title"><a href="/2015/05/19/spoke-at-geomob/">spoke at Geomob</a></h4>
        <p class="card-text"><p>â€‹It was with great pride that I spoke at #Geomob</p>
</p>
      </div>
      <div class="card-footer">
        <small>May 19</small>
        <span class="label label-pill label-info pull-right">2015</span>
      </div>
    </div>
</div>


    </div>

    <div class="container">
  <span>It's All In The Game blog (c) 2005-16 by Jez Nicholson</span>
</div>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-5854204-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- Bootstrap 4 Alpha JS -->
<!-- IMPORTANT: Don't use this .js file in production. Use Bootstrap 3 until Bootstrap 4.0.0 is released. -->
<script src="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/js/bootstrap.js"></script> 

  </body>
</html>
