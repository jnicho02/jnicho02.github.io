<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>

    parsing csv files with groovy</title>
    <!-- Bootstrap 4 alpha CSS -->
    <!-- IMPORTANT: Don't use this .css file in production. Use Bootstrap 3 until Bootstrap 4.0.0 is released. -->
    <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css">

    <link href="/stylesheets/normalize.css" rel="stylesheet" /><link href="/stylesheets/all.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
  </head>

  <body class="x2011 x2011_08 x2011_08_02 x2011_08_02_parsing-csv-files-with-groovy x2011_08_02_parsing-csv-files-with-groovy_index">


        <nav class="navbar navbar-fixed-top navbar-dark bg-inverse">
      <!-- Brand -->
      <a class="navbar-brand" href="/"><img src="/images/jez.jpg" width="80em" class="img-circle pull-left" alt="Photo of Jez Nicholson"></a>
      <!-- Links -->
      <ul class="nav navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Link 2</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Contact</a>
        </li>
      </ul>
    </nav>

    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <div class="container-fluid">
      <h1>parsing csv files with groovy</h1>
      <p>We have a piece of software that insists on generating a type of csv file containing multiple datasets. I'm currently turning this into XML to make it easier to process (funny that, people seem to have a downer on xml most of the time). I want to parse the csv without knowing what the columns will be, plus they can be speechmark delimitted and maybe contain carriage returns.
Anyway, it seems easy to start with and then gets more and more involved. Let's face it, life is too short to write a full parser for myself. I did a bit of research and took the opportunity to try it out in groovy. My latest version uses a groovy wrapper <a href="https://github.com/xlson/groovycsv/">https://github.com/xlson/groovycsv/</a> of <a href="http://opencsv.sourceforge.net/">http://opencsv.sourceforge.net/</a>
UPDATE: my good friend and ex-colleague @nugsie suggested a MarkupBuilder….</p>

<p>'''groovy</p>

<pre><code>@Grab('com.xlson.groovycsv:groovycsv:0.2')
import com.xlson.groovycsv.CsvParser
import groovy.xml.MarkupBuilder

def csv = '''field_one,field_two,field_three
ay,"be""e",sea
ay,"bee
multiline",sea'''

def writer = new StringWriter()
def xml = new MarkupBuilder(writer)
def data = new CsvParser().parse(csv)
xml.records() {
&amp;nbsp; &amp;nbsp;data.each { line -&amp;gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp;feature() {
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;line.columns.each { columnName, index -&amp;gt;
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;"${columnName}"(line.values[index])
&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;}
&amp;nbsp; &amp;nbsp; &amp;nbsp;}
&amp;nbsp; &amp;nbsp;}
}
 
writer.toString() '''
</code></pre>

<p>output from which is:</p>

<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;records&gt;
   &lt;Feature&gt;
     &lt;field_one&gt;ay&lt;/field_one&gt;
     &lt;field_two&gt;be"e&lt;/field_two&gt;
     &lt;field_three&gt;sea&lt;/field_three&gt;
   &lt;/Feature&gt;
   &lt;Feature&gt;
     &lt;field_one&gt;ay&lt;/field_one&gt;
     &lt;field_two&gt;bee
 multiline&lt;/field_two&gt;
     &lt;field_three&gt;sea&lt;/field_three&gt;
   &lt;/Feature&gt;
 &lt;/records&gt;</p>

<p>…nice.</p>

    </div>

    <div class="container">
  <span>It's All In The Game blog (c) 2005-16 by Jez Nicholson</span>
</div>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-5854204-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- Bootstrap 4 Alpha JS -->
<!-- IMPORTANT: Don't use this .js file in production. Use Bootstrap 3 until Bootstrap 4.0.0 is released. -->
<script src="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/js/bootstrap.js"></script> 

  </body>
</html>
