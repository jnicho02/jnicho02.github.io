<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>

    First steps towards open source OpenStreetMap Points Of Interest POI data</title>
    <!-- Bootstrap 4 alpha CSS -->
    <!-- IMPORTANT: Don't use this .css file in production. Use Bootstrap 3 until Bootstrap 4.0.0 is released. -->
    <link rel="stylesheet" href="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/css/bootstrap.css">

    <link href="/stylesheets/normalize.css" rel="stylesheet" /><link href="/stylesheets/all.css" rel="stylesheet" />
    <script src="/javascripts/all.js"></script>
  </head>

  <body class="x2011 x2011_06 x2011_06_06 x2011_06_06_first-steps-towards-open-source-openstreetmap x2011_06_06_first-steps-towards-open-source-openstreetmap_index">


        <nav class="navbar navbar-fixed-top navbar-dark bg-inverse">
      <!-- Brand -->
      <a class="navbar-brand" href="/"><img src="/images/jez.jpg" width="80em" class="img-circle pull-left" alt="Photo of Jez Nicholson"></a>
      <!-- Links -->
      <ul class="nav navbar-nav">
        <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
        <li class="nav-item"><a class="nav-link" href="/tags/">Tags</a></li>
      </ul>
    </nav>

    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <br/>
    <div class="container-fluid">
      <h1>First steps towards open source OpenStreetMap Points Of Interest POI data</h1>
      <div class="p_embed p_image_embed">
<a href="/media/getfile/files.posterous.com/temp-2011-06-06/nnikuqgbyqFHvawqjliHmcGbvmwbbFhfwcifbgdnvryHFgoiCcHJhguAycxn/spatialite_pois.JPG.scaled1000.jpg"><img alt="Spatialite_pois" height="350" src="/media/getfile/files.posterous.com/temp-2011-06-06/nnikuqgbyqFHvawqjliHmcGbvmwbbFhfwcifbgdnvryHFgoiCcHJhguAycxn/spatialite_pois.JPG.scaled500.jpg" width="500" /></a>
</div>

<p>I'm working with some European data at the moment, part of which is POI data for "nearest hospital", "nearest educational facility", etc. and the data is quite poor. I suspect that it originally sourced from NavTec and hence "Yellow Books". I also suspect that the data in OpenStreetMap will be orders of magnitude more accurate.</p>

<p>My first port of call was to examine the attributes used in OSM. To do this I download an area of central Dublin into JOSM and look at the raw data. Taking hospitals as an example I can quickly see that these are encoded in three different ways:</p>

<ul>
  <li>As point data with an attributes of "amenity=hospital" and "name=foo"</li>
  <li>As an area, again marked "amenity=hospital" and "name=foo"</li>
  <li>As a building, which is an area also marked with "building=hospital". Hospital buildings are often placed within a hospital area, but not necessarily.</li>
</ul>

<p>I've then taken a look at <a href="http://www.gaia-gis.it/spatialite">SpatiaLite</a> which is a really lightweight file-based database server. This would be great for packaging with an app, but is also good for quick experiments. I may need to go up to PostGIS if it isn't up to the job.</p>

<p>I downloaded the spatialite-gui binary for Windows, unzipped it and ran it.</p>

<p>From <a href="http://download.geofabrik.de/osm/europe/">GeoFabrik</a> I downloaded <a href="http://download.geofabrik.de/osm/europe/ireland.shp.zip">ireland.shp.zip</a></p>

<div class="p_embed p_image_embed">
<a href="/media/getfile/files.posterous.com/temp-2011-06-06/yvgcIAisAGopCbbGylJtHDienxBnqofebnGwFxjprcdaoGberDEJityaAtdr/loadshapefile.JPG.scaled1000.jpg"><img alt="Loadshapefile" height="411" src="/media/getfile/files.posterous.com/temp-2011-06-06/yvgcIAisAGopCbbGylJtHDienxBnqofebnGwFxjprcdaoGberDEJityaAtdr/loadshapefile.JPG.scaled500.jpg" width="500" /></a>
</div>

<p>In the SpatialLite GUI I created a new database and then went to "Load Shapefile", I picked a .shp file from my downloaded data and set the SRID to 4326 (which is the id in the spatial_ref_sys table for WGS-84) and the charset to UTF-8. It then imported in a matter of seconds. This gave me a sql table that I could query using extra functions such as Distance()</p>

<p>I got a WGS-84 lat/lon for my search point by right-clicking on Google Maps and doing a "Drop LatLng Marker" (I can't remember whether this is an opt-in feature). I have since worked out that SpatialLite expects the coordinated to be the other way round: lon/lat and not lat/lon.</p>

<pre><code>SELECT ROWID, "PK_UID", "osm_id", "name", "type"
, Distance("Geometry" ,GeomFromText('POINT(-6.2626 53.34942)'))*100000 AS dist
FROM "points"
WHERE "type" = "hospital"
ORDER BY dist
</code></pre>

<p>gives me a result set starting with: osmid=641802162, name=Dublin Dental Hospital, distance 1289m</p>

<p>When I query the buildings I get: osmid=51776450, name=NULL, distance 261m…which is the first building of the Rotunda Maternity Hospital.</p>

<p>What I don't know is where to get hold of the area data. Is it in the road shapefile?! I think not. So where would it be?</p>

<p>Enrico Zini's post <a href="http://www.enricozini.org/2010/tips/osm-import-nodes/&quot; title=&quot;Importing OSM nodes into Spatialite">Importing OSM nodes into Spatialite</a></p>

<ul>
  <li>as I am using Windows (not by choice, they made me do it!) I needed to download and install libspatialite, proj, geos and libiconv dlls from <a href="http://www.gaia-gis.it/spatialite/binaries.html">http://www.gaia-gis.it/spatialite/binaries.html</a></li>
  <li>I needed pysqlite for my python 2.5 installation from <a href="http://code.google.com/p/pysqlite/downloads/list">http://code.google.com/p/pysqlite/downloads/list</a></li>
  <li>I also needed simplejson which I got via easy_install</li>
  <li>The script needed to point to the .dll and not an .so -self.db.execute("SELECT load_extension('libspatialite-1.dll')")</li>
  <li>
    <p>dict() doesn't like it when a key doesn't exist, so if there is an OSM node with no tags["name"] the program will error. Instead, I used defaultdict() with: from collections import defaultdict and self.tags = defaultdict(str)</p>

    <p>SELECT poi."id", tag."name", Distance("geom" ,GeomFromText('POINT(-6.2626 53.34942)'))*100000 AS dist, poi."name", "data"
  FROM "poi", "poitag", "tag"
  WHERE poi.id = poitag.poi
  AND poitag.tag = tag.id
  AND tag."value" = "cafe"
  ORDER BY dist</p>
  </li>
</ul>

    </div>

    <div class="container-fluid" name="tags">
        <a href="/tags/geo/">
        <span class="label label-pill label-info pull-left">geo</span>
        </a>
        <a href="/tags/osm/">
        <span class="label label-pill label-primary pull-left">osm</span>
        </a>
        <a href="/tags/opendata/">
        <span class="label label-pill label-success pull-left">opendata</span>
        </a>
    </div>
    <div class="container">
  <span>It's All In The Game blog (c) 2005-16 by Jez Nicholson</span>
</div>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-5854204-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- Bootstrap 4 Alpha JS -->
<!-- IMPORTANT: Don't use this .js file in production. Use Bootstrap 3 until Bootstrap 4.0.0 is released. -->
<script src="https://cdn.rawgit.com/twbs/bootstrap/v4-dev/dist/js/bootstrap.js"></script> 

  </body>
</html>
